(window.webpackJsonp=window.webpackJsonp||[]).push([[21],{271:function(t,e,r){"use strict";var n=r(39),o=r(16),i=r(41),a=r(117),s=r(272),c=r(273);n({target:"Promise",stat:!0},{allSettled:function(t){var e=this,r=a.f(e),n=r.resolve,u=r.reject,f=s((function(){var r=i(e.resolve),a=[],s=0,u=1;c(t,(function(t){var i=s++,c=!1;u++,o(r,e,t).then((function(t){c||(c=!0,a[i]={status:"fulfilled",value:t},--u||n(a))}),(function(t){c||(c=!0,a[i]={status:"rejected",reason:t},--u||n(a))}))})),--u||n(a)}));return f.error&&u(f.value),r.promise}})},272:function(t,e){t.exports=function(t){try{return{error:!1,value:t()}}catch(t){return{error:!0,value:t}}}},273:function(t,e,r){var n=r(0),o=r(118),i=r(16),a=r(13),s=r(61),c=r(274),u=r(116),f=r(76),l=r(119),d=r(77),p=r(275),h=n.TypeError,w=function(t,e){this.stopped=t,this.result=e},m=w.prototype;t.exports=function(t,e,r){var n,g,v,y,_,E,S,R=r&&r.that,I=!(!r||!r.AS_ENTRIES),b=!(!r||!r.IS_ITERATOR),j=!(!r||!r.INTERRUPTED),A=o(e,R),D=function(t){return n&&p(n,"normal",t),new w(!0,t)},T=function(t){return I?(a(t),j?A(t[0],t[1],D):A(t[0],t[1])):j?A(t,D):A(t)};if(b)n=t;else{if(!(g=d(t)))throw h(s(t)+" is not iterable");if(c(g)){for(v=0,y=u(t);y>v;v++)if((_=T(t[v]))&&f(m,_))return _;return new w(!1)}n=l(t,g)}for(E=n.next;!(S=i(E,n)).done;){try{_=T(S.value)}catch(t){p(n,"throw",t)}if("object"==typeof _&&_&&f(m,_))return _}return new w(!1)}},274:function(t,e,r){var n=r(9),o=r(42),i=n("iterator"),a=Array.prototype;t.exports=function(t){return void 0!==t&&(o.Array===t||a[i]===t)}},275:function(t,e,r){var n=r(16),o=r(13),i=r(60);t.exports=function(t,e,r){var a,s;o(t);try{if(!(a=i(t,"return"))){if("throw"===e)throw r;return r}a=n(a,t)}catch(t){s=!0,a=t}if("throw"===e)throw r;if(s)throw a;return o(a),r}},385:function(t,e,r){"use strict";r.r(e);r(271),r(5);var n=r(31),o=r(2),i=r(59);e.default=(t={})=>{const{gmcMerchantId:e,dialogPosition:r}=t;if(e){const t=window.storefrontApp&&window.storefrontApp.router;if(t){const a=({name:t,params:a})=>{if("confirmation"===t&&a.json){const t=t=>{const e=new Date(Date.now());return e.setDate(e.getDate()+t),e};let s,c,u,f;const l=decodeURIComponent(a.json);if(l)try{s=JSON.parse(l)}catch(t){}if(s){const{buyers:e}=s;e&&e[0]&&(c=e[0].main_email);const r=s.shipping_lines&&s.shipping_lines[0];if(r&&r.delivery_time){let e=r.delivery_time.days;r.posting_deadline&&(e+=r.delivery_time.days),r.delivery_time.working_days&&(e*=1.25),f=t(e+3)}}c||(c=i.a.getCustomer().main_email),u||(u=n.$ecomConfig.get("country_code")),f||(f=t(14));const d=[],p=[],h={merchant_id:e,order_id:a.number||a.id,email:c,delivery_country:u,estimated_delivery_date:f.getFullYear()+"-".concat((f.getMonth()+1).toString().padStart(2,"0"),"-")+f.getDate().toString().padStart(2,"0"),opt_in_style:r||"CENTER_DIALOG"};if(s&&s.items)for(let t=0;t<s.items.length&&t<=4;t++)d.push(Object(o.g)({url:"/products/".concat(s.items[t].product_id,".json")}).then((({data:t})=>{t.gtin&&t.gtin.forEach((t=>{p.includes(t)||p.push(t)}))})).catch(console.error));Promise.allSettled(d).then((()=>{p.length&&(h.products=p.map((t=>({gtin:t})))),window.gapi.load("surveyoptin",(function(){window.gapi.surveyoptin.render(h)}))}))}};t.currentRoute&&a(t.currentRoute),t.afterEach(a)}}else console.error(new Error("Can't show opt-in dialog without `gmcMerchantId` option"))}}}]);